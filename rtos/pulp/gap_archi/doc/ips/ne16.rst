Input file: fe/ips/ne16/docs/ne16.md

Register map
^^^^^^^^^^^^


Overview
""""""""

.. table:: 

    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |                      Name                      |Offset|Width|                                                                Description                                                                 |
    +================================================+======+=====+============================================================================================================================================+
    |:ref:`TRIGGER<ne16_TRIGGER>`                    |     0|   32|Write 0 to start execution, unlock controller.                                                                                              |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`ACQUIRE<ne16_ACQUIRE>`                    |     4|   32|On read starts a job offload, locks controller. Returns job ID.                                                                             |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`FINISHED_JOBS<ne16_FINISHED_JOBS>`        |     8|   32|Returns number of completed jobs.                                                                                                           |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`STATUS<ne16_STATUS>`                      |    12|   32|Returns status of jobs in the queue (each byte is a different job).                                                                         |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`RUNNING_JOB<ne16_RUNNING_JOB>`            |    16|   32|Returns ID of currently running job.                                                                                                        |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SOFT_CLEAR<ne16_SOFT_CLEAR>`              |    20|   32|Soft-clears the NE16 at any write.                                                                                                          |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`MICROCODE<ne16_MICROCODE>`                |    24|   32|Reserved.                                                                                                                                   |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SW_SYNC<ne16_SW_SYNC>`                    |    28|   32|Triggers a SW event inside NE16 (e.g. for DMA synchronization).                                                                             |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`WEIGHTS_PTR<ne16_WEIGHTS_PTR>`            |    32|   32|Pointer to Weights tensor in memory (d3=Ko, d2=KiMaj, d1=Qw, d0=Fx<em>Fy</em>Kimin for 3x3 mode; d2=Ko, d1=KiMaj, d0=Qw*KiMin for 1x1 mode).|
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`INFEAT_PTR<ne16_INFEAT_PTR>`              |    36|   32|Pointer to InFeat tensor in memory (d2=Hi, d1=Wi, d0=Ki).                                                                                   |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`OUTFEAT_PTR<ne16_OUTFEAT_PTR>`            |    40|   32|Pointer to OutFeat tensor in memory (d2=Ho, d1=Wo, d0=Ko).                                                                                  |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SCALE_PTR<ne16_SCALE_PTR>`                |    44|   32|Pointer to Scale parameters in memory (d0=Ko).                                                                                              |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SCALE_SHIFT_PTR<ne16_SCALE_SHIFT_PTR>`    |    48|   32|Pointer to Scale parameters in memory (d0=Ko).                                                                                              |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SCALE_BIAS_PTR<ne16_SCALE_BIAS_PTR>`      |    52|   32|Pointer to Scale parameters in memory (d0=Ko).                                                                                              |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`INFEAT_D0_STRIDE<ne16_INFEAT_D0_STRIDE>`  |    56|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`INFEAT_D1_STRIDE<ne16_INFEAT_D1_STRIDE>`  |    60|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`INFEAT_D2_STRIDE<ne16_INFEAT_D2_STRIDE>`  |    64|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`OUTFEAT_D0_STRIDE<ne16_OUTFEAT_D0_STRIDE>`|    68|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`OUTFEAT_D1_STRIDE<ne16_OUTFEAT_D1_STRIDE>`|    72|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`OUTFEAT_D2_STRIDE<ne16_OUTFEAT_D2_STRIDE>`|    76|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`WEIGHTS_D0_STRIDE<ne16_WEIGHTS_D0_STRIDE>`|    80|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`WEIGHTS_D1_STRIDE<ne16_WEIGHTS_D1_STRIDE>`|    84|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`WEIGHTS_D2_STRIDE<ne16_WEIGHTS_D2_STRIDE>`|    88|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SUBTILE_REM0<ne16_SUBTILE_REM0>`          |    92|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SUBTILE_REM1<ne16_SUBTILE_REM1>`          |    96|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SUBTILE_REM2<ne16_SUBTILE_REM2>`          |   100|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SUBTILE_NB0<ne16_SUBTILE_NB0>`            |   104|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`SUBTILE_NB1<ne16_SUBTILE_NB1>`            |   108|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`PADDING<ne16_PADDING>`                    |   112|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`WEIGHT_OFFSET<ne16_WEIGHT_OFFSET>`        |   116|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`FILTER_MASK<ne16_FILTER_MASK>`            |   120|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+
    |:ref:`CONFIG0<ne16_CONFIG0>`                    |   124|   32|                                                                                                                                            |
    +------------------------------------------------+------+-----+--------------------------------------------------------------------------------------------------------------------------------------------+

.. _ne16_TRIGGER:

TRIGGER
"""""""

Write 0 to start execution, unlock controller.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_ACQUIRE:

ACQUIRE
"""""""

On read starts a job offload, locks controller. Returns job ID.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_FINISHED_JOBS:

FINISHED_JOBS
"""""""""""""

Returns number of completed jobs.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_STATUS:

STATUS
""""""

Returns status of jobs in the queue (each byte is a different job).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_RUNNING_JOB:

RUNNING_JOB
"""""""""""

Returns ID of currently running job.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SOFT_CLEAR:

SOFT_CLEAR
""""""""""

Soft-clears the NE16 at any write.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_MICROCODE:

MICROCODE
"""""""""

Reserved.

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SW_SYNC:

SW_SYNC
"""""""

Triggers a SW event inside NE16 (e.g. for DMA synchronization).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_WEIGHTS_PTR:

WEIGHTS_PTR
"""""""""""

Pointer to Weights tensor in memory (d3=Ko, d2=KiMaj, d1=Qw, d0=Fx<em>Fy</em>Kimin for 3x3 mode; d2=Ko, d1=KiMaj, d0=Qw*KiMin for 1x1 mode).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_INFEAT_PTR:

INFEAT_PTR
""""""""""

Pointer to InFeat tensor in memory (d2=Hi, d1=Wi, d0=Ki).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_OUTFEAT_PTR:

OUTFEAT_PTR
"""""""""""

Pointer to OutFeat tensor in memory (d2=Ho, d1=Wo, d0=Ko).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SCALE_PTR:

SCALE_PTR
"""""""""

Pointer to Scale parameters in memory (d0=Ko).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SCALE_SHIFT_PTR:

SCALE_SHIFT_PTR
"""""""""""""""

Pointer to Scale parameters in memory (d0=Ko).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SCALE_BIAS_PTR:

SCALE_BIAS_PTR
""""""""""""""

Pointer to Scale parameters in memory (d0=Ko).

.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_INFEAT_D0_STRIDE:

INFEAT_D0_STRIDE
""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_INFEAT_D1_STRIDE:

INFEAT_D1_STRIDE
""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_INFEAT_D2_STRIDE:

INFEAT_D2_STRIDE
""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_OUTFEAT_D0_STRIDE:

OUTFEAT_D0_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_OUTFEAT_D1_STRIDE:

OUTFEAT_D1_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_OUTFEAT_D2_STRIDE:

OUTFEAT_D2_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_WEIGHTS_D0_STRIDE:

WEIGHTS_D0_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_WEIGHTS_D1_STRIDE:

WEIGHTS_D1_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_WEIGHTS_D2_STRIDE:

WEIGHTS_D2_STRIDE
"""""""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_SUBTILE_REM0:

SUBTILE_REM0
""""""""""""



.. table:: 

    +-----+---+----+-------------+
    |Bit #|R/W|Name| Description |
    +=====+===+====+=============+
    |15:0 |R/W|KI  |Ki remainder.|
    +-----+---+----+-------------+
    |31:16|R/W|KO  |Ko remainder.|
    +-----+---+----+-------------+

.. _ne16_SUBTILE_REM1:

SUBTILE_REM1
""""""""""""



.. table:: 

    +-----+---+----+-------------+
    |Bit #|R/W|Name| Description |
    +=====+===+====+=============+
    |15:0 |R/W|WO  |Wo remainder.|
    +-----+---+----+-------------+
    |31:16|R/W|HO  |Ho remainder.|
    +-----+---+----+-------------+

.. _ne16_SUBTILE_REM2:

SUBTILE_REM2
""""""""""""



.. table:: 

    +-----+---+----+-------------+
    |Bit #|R/W|Name| Description |
    +=====+===+====+=============+
    |15:0 |R/W|WI  |Wi remainder.|
    +-----+---+----+-------------+
    |31:16|R/W|HI  |Hi remainder.|
    +-----+---+----+-------------+

.. _ne16_SUBTILE_NB0:

SUBTILE_NB0
"""""""""""



.. table:: 

    +-----+---+----+-------------+
    |Bit #|R/W|Name| Description |
    +=====+===+====+=============+
    |15:0 |R/W|KI  |Ki remainder.|
    +-----+---+----+-------------+
    |31:16|R/W|KO  |Ko remainder.|
    +-----+---+----+-------------+

.. _ne16_SUBTILE_NB1:

SUBTILE_NB1
"""""""""""



.. table:: 

    +-----+---+----+-------------+
    |Bit #|R/W|Name| Description |
    +=====+===+====+=============+
    |15:0 |R/W|WO  |Wo remainder.|
    +-----+---+----+-------------+
    |31:16|R/W|HO  |Ho remainder.|
    +-----+---+----+-------------+

.. _ne16_PADDING:

PADDING
"""""""



.. table:: 

    +-----+---+------+------------------------------------------------------------------------------------------------+
    |Bit #|R/W| Name |                                          Description                                           |
    +=====+===+======+================================================================================================+
    |15:0 |R/W|VALUE |Padding value.                                                                                  |
    +-----+---+------+------------------------------------------------------------------------------------------------+
    |19:16|R/W|LEFT  |Number of spatially padded pixels in the LEFT subtile border.                                   |
    +-----+---+------+------------------------------------------------------------------------------------------------+
    |23:20|R/W|BOTTOM|Number of spatially padded pixels in the BOTTOM subtile border (counted from 5 pixels upward!). |
    +-----+---+------+------------------------------------------------------------------------------------------------+
    |27:24|R/W|RIGHT |Number of spatially padded pixels in the RIGHT subtile border (counted from 5 pixels leftward!).|
    +-----+---+------+------------------------------------------------------------------------------------------------+
    |31:28|R/W|TOP   |Number of spatially padded pixels in the TOP subtile border.                                    |
    +-----+---+------+------------------------------------------------------------------------------------------------+

.. _ne16_WEIGHT_OFFSET:

WEIGHT_OFFSET
"""""""""""""



.. table:: 

    +-----+---+----+-----------+
    |Bit #|R/W|Name|Description|
    +=====+===+====+===========+
    +-----+---+----+-----------+

.. _ne16_FILTER_MASK:

FILTER_MASK
"""""""""""



.. table:: 

    +-----+---+------+------------+
    |Bit #|R/W| Name |Description |
    +=====+===+======+============+
    |7:0  |R/W|LEFT  |Left mask.  |
    +-----+---+------+------------+
    |15:8 |R/W|BOTTOM|Bottom mask.|
    +-----+---+------+------------+
    |23:16|R/W|RIGHT |Right mask. |
    +-----+---+------+------------+
    |31:24|R/W|TOP   |Top mask.   |
    +-----+---+------+------------+

.. _ne16_CONFIG0:

CONFIG0
"""""""





.. table:: 

    +-----+---+-----------+--------------------------------------------------------------------------------+
    |Bit #|R/W|   Name    |                                  Description                                   |
    +=====+===+===========+================================================================================+
    |2:0  |R/W|QWM1       |Weight bits minus 1.                                                            |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |3    |R/W|MODE16     |16-bit input data mode.                                                         |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |4    |R/W|STREAMOUT  |Streamout / quantization (1=quantization+streamout, 0=streamout only).          |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |6:5  |R/W|FILTER_MODE|Filter mode (11=reserved, 10=1x1, 01=3x3 depthwise, 00=3x3).                    |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |7    |R/W|LINEAR     |Linear mode (experimental).                                                     |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |8    |R/W|STRIDED_2X2|2x2 strided mode (experimental).                                                |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |10:9 |R/W|RES1       |Reserved.                                                                       |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |11   |R/W|ROUND      |Rounding mode (0=round, 1=do not round).                                        |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |13:12|R/W|NORM_BITS  |Normalization bits (00=8b, 01=16b, 10=32b).                                     |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |14   |R/W|STREAMIN   |Streamin mode (1=do streamin, 0=do not streamin).                               |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |15   |R/W|WEIGHT_OFFS|Weight offset cfg (0=symmetric weights, 1=use layer-wise weight_offset).        |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |20:16|R/W|RIGHT_SHIFT|Quantization right shift.                                                       |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |22:21|R/W|QUANT_BITS |Quantization bits (00=8b, 01=16b, 10=32b).                                      |
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |23   |R/W|QUANT_RECT |Quantization rect(0=rectify, consider as unsigned; 1=do not rectify, keep sign).|
    +-----+---+-----------+--------------------------------------------------------------------------------+
    |31:24|R/W|RES2       |Reserved.                                                                       |
    +-----+---+-----------+--------------------------------------------------------------------------------+
